<!DOCTYPE html>
<html lang="en">
    <head>    
        <title>PHP中文字符串切割，生成文章摘要-『Honoer.com』Web技术</title>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="Description" content="web技术分享平台，技术的沉淀" />
        <meta name="Keywords" content="web技术，PHP，JS" />
        <meta property="qc:admins" content="514175567760767526375" />
        <link type="text/css" rel="stylesheet" href="/Honoer/Tpl/Home/Default/Public/Css/style.css"/>

        <!--[if lt IE 9]><script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
        <link type="text/css" rel="stylesheet" href="/Public/Plugins/syntaxhighlighter/styles/shCore.css"/>
        <link type="text/css" rel="stylesheet" href="/Public/Plugins/syntaxhighlighter/styles/shThemeDefault.css"/>
        <script type='text/javascript' src="/Public/Plugins/jQuery/jquery-1.7.1.min.js"></script> 
        <script type="text/javascript">
        var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "//hm.baidu.com/hm.js?45b34fa03392243e4038fd601390f9dc";
            var s = document.getElementsByTagName("script")[0]; 
            s.parentNode.insertBefore(hm, s);
        })();
    </script>        <script type='text/javascript'>
            <!--	
            var URL='/Article';
            var ROOT='';
            var PUBLIC='/Public';
            var Public='/Honoer/Tpl/Home/Default/Public';
            //-->
        </script>
    </head>  
    <body>
        <div class="header">
            <header class="clearfix">
                <hgroup>
    <a href="http://www.honoer.com" title="『Honoer.com』Web技术">
        <img alt="『Honoer.com』Web技术" src="/Honoer/Tpl/Home/Default/Public/Images/logo.gif">
    </a>
</hgroup>



<nav>
    <ul>
        <li >
                            <a href="/Index/index">首页</a>            </li><li class="active">
            <a class="nav-child" href="/Article/index">文章<i class="icon-caret"></i></a>
                <dl>
                    <dd >
                        <a href="/Article/index/cid/1">PHP</a>
                        </dd><dd >
                        <a href="/Article/index/cid/2">HTML</a>
                        </dd><dd >
                        <a href="/Article/index/cid/3">JS</a>
                        </dd>                </dl>
                            </li><li >
                            <a href="/About/index">关于Me</a>            </li>    </ul>
</nav>


<form class="search" action="/Article/index" method="get">
    <input name="keyword" placeholder="请输入关键词" type="text" value="">
    <button class="btn" name="search" value="Go!" type="submit">Go!</button>
<input type="hidden" name="__hash__" value="ee640c010f391e512ea705ab2eeae4bf_22691f10ab60e44a2c1bb5cd272e2bcf" /></form>
            </header>
        </div>
        <div class="wrap clearfix">
            <div class="span9">
    <article class="clearfix box">
        <div class="item-box">
                <span class="item-tit">
                    <h2>PHP中文字符串切割，生成文章摘要</h2>
                </span>
                <div class="item-tags">
                    <span>Tags:PHP</span>
                    <span>Reply:95</span>
                    <span>Time:2012-08-28</span>
                    <span>Author:admin</span>
                </div>
                <div class="item-intro"><p>发两个字符串截取函数，经常用到的，很好！</p><p> </p><p>第一个函数 <span style="font-family:courier new">blog_summary() 生成文章摘要的，能把html标签保留且不会影响整体样式：</span></p><pre class="brush:php;">/******************************** 
 * 生成摘要 
 * @param (string) $body 
 *  正文 
 * @param (int) $size 
 *  摘要长度 
 * @param (int) $format 
 *  输入格式 id 
 *******************************/
function blog_summary($body, $size, $format = NULL){ 
  $_size = mb_strlen($body, 'utf-8'); 
  
  if($_size &lt;= $size) return $body; 
  
  // 输入格式中有 PHP 过滤器 
  if(!isset($format) &amp;&amp; filter_is_php($format)){ 
    return $body; 
  } 
  
  $strlen_var = strlen($body); 
  
  // 不包含 html 标签 
  if(strpos($body, '&lt;') === false){ 
    return mb_substr($body, 0, $size); 
  } 
  
  // 包含截断标志，优先 
  if($e = strpos($body, '&lt;!-- break --&gt;')){ 
    return mb_substr($body, 0, $e); 
  } 
  
  // html 代码标记 
  $html_tag = 0; 
  
  // 摘要字符串 
  $summary_string = ''; 
  
  /** 
   * 数组用作记录摘要范围内出现的 html 标签 
   * 开始和结束分别保存在 left 和 right 键名下 
   * 如字符串为：&lt;h3&gt;&lt;p&gt;&lt;b&gt;a&lt;/b&gt;&lt;/h3&gt;，假设 p 未闭合 
   * 数组则为：array('left' =&gt; array('h3', 'p', 'b'), 'right' =&gt; 'b', 'h3'); 
   * 仅补全 html 标签，&lt;? &lt;% 等其它语言标记，会产生不可预知结果 
   */
  $html_array = array('left' =&gt; array(), 'right' =&gt; array()); 
  for($i = 0; $i &lt; $strlen_var; ++$i) { 
    if(!$size){ 
      break; 
    } 
  
    $current_var = substr($body, $i, 1); 
  
    if($current_var == '&lt;'){ 
      // html 代码开始 
      $html_tag = 1; 
      $html_array_str = ''; 
    }else if($html_tag == 1){ 
      // 一段 html 代码结束 
      if($current_var == '&gt;'){ 
        /** 
         * 去除首尾空格，如 &lt;br /  &gt; &lt; img src="" / &gt; 等可能出现首尾空格 
         */
        $html_array_str = trim($html_array_str); 
  
        /** 
         * 判断最后一个字符是否为 /，若是，则标签已闭合，不记录 
         */
        if(substr($html_array_str, -1) != '/'){ 
  
          // 判断第一个字符是否 /，若是，则放在 right 单元 
          $f = substr($html_array_str, 0, 1); 
          if($f == '/'){ 
            // 去掉 / 
            $html_array['right'][] = str_replace('/', '', $html_array_str); 
          }else if($f != '?'){ 
            // 判断是否为 ?，若是，则为 PHP 代码，跳过 
  
            /** 
             * 判断是否有半角空格，若有，以空格分割，第一个单元为 html 标签 
             * 如 &lt;h2&gt; &lt;p&gt; 
             */
            if(strpos($html_array_str, ' ') !== false){ 
              // 分割成2个单元，可能有多个空格，如：&lt;h2 class="" id=""&gt; 
              $html_array['left'][] = strtolower(current(explode(' ', $html_array_str, 2))); 
            }else{ 
              /** 
               * * 若没有空格，整个字符串为 html 标签，如：&lt;b&gt; &lt;p&gt; 等 
               * 统一转换为小写 
               */
              $html_array['left'][] = strtolower($html_array_str); 
            } 
          } 
        } 
  
        // 字符串重置 
        $html_array_str = ''; 
        $html_tag = 0; 
      }else{ 
        /** 
         * 将&lt; &gt;之间的字符组成一个字符串 
         * 用于提取 html 标签 
         */
        $html_array_str .= $current_var; 
      } 
    }else{ 
      // 非 html 代码才记数 
      --$size; 
    } 
  
    $ord_var_c = ord($body{$i}); 
  
    switch (true) { 
      case (($ord_var_c &amp; 0xE0) == 0xC0): 
        // 2 字节 
        $summary_string .= substr($body, $i, 2); 
        $i += 1; 
      break; 
      case (($ord_var_c &amp; 0xF0) == 0xE0): 
  
        // 3 字节 
        $summary_string .= substr($body, $i, 3); 
        $i += 2; 
      break; 
      case (($ord_var_c &amp; 0xF8) == 0xF0): 
        // 4 字节 
        $summary_string .= substr($body, $i, 4); 
        $i += 3; 
      break; 
      case (($ord_var_c &amp; 0xFC) == 0xF8): 
        // 5 字节 
        $summary_string .= substr($body, $i, 5); 
        $i += 4; 
      break; 
      case (($ord_var_c &amp; 0xFE) == 0xFC): 
        // 6 字节 
        $summary_string .= substr($body, $i, 6); 
        $i += 5; 
      break; 
      default: 
        // 1 字节 
        $summary_string .= $current_var; 
    } 
  } 
  
  if($html_array['left']){ 
    /** 
     * 比对左右 html 标签，不足则补全 
     */
  
    /** 
     * 交换 left 顺序，补充的顺序应与 html 出现的顺序相反 
     * 如待补全的字符串为：&lt;h2&gt;abc&lt;b&gt;abc&lt;p&gt;abc 
     * 补充顺序应为：&lt;/p&gt;&lt;/b&gt;&lt;/h2&gt; 
     */
    $html_array['left'] = array_reverse($html_array['left']); 
  
    foreach($html_array['left'] as $index =&gt; $tag){ 
      // 判断该标签是否出现在 right 中 
      $key = array_search($tag, $html_array['right']); 
      if($key !== false){ 
        // 出现，从 right 中删除该单元 
        unset($html_array['right'][$key]); 
      }else{ 
        // 没有出现，需要补全 
        $summary_string .= '&lt;/'.$tag.'&gt;'; 
      } 
    } 
  } 
  return $summary_string.'...'; 
}</pre><p>第二个函数CnSub（）对中文的截取效果很好。</p><pre class="brush:php;">function CnSub($str,$len){  
 if($str=='' || strlen($str)&lt;=$len) return $str; 
 if(ord(substr($str,$len-1,1))&gt;0xa0) $len++; 
 return substr($str,0,$len); 
}</pre><p> </p><p> </p></div>
            </div>
            <div class="pager">
                <span>上一篇：&nbsp;<a href="/Article/read/aid/22" title="弹出窗口插件colorbox ">弹出窗口插件colorbox </a></span>
                <span>下一篇：&nbsp;<a href="/Article/read/aid/24" title="DIV外部点击事件">DIV外部点击事件</a></span>
            </div>
             
    </article>
    <section class="hd-msg">
            </section>
    <section class="hd-form">
        
<fieldset>
    <legend>我来说一说</legend>
    <form class="form" action="/Article/reply/aid/23" method="post" role="validationFrom">
        <ul>
            <li>
                <label class="k"><em>*</em>Email:</label>
                <span class="v"><input type="text" name="comment_email" value="" datatype="e" errormsg="邮箱格式不正确！" ></span>
                <span class="Validform_checktip">邮箱不会公开~</span>
            </li>
            <li>
                <label class="k"><em>*</em>Content:</label>
                <span class="v"><textarea rows="4" cols="50" name="comment_content" datatype="*6-255"></textarea></span>
                <span class="Validform_checktip"></span>
            </li>
            <li>
                <label class="k">&nbsp;</label>
                <span class="v"><button type="submit" class="btn">留言</button></span>
            </li>
        </ul>
    <input type="hidden" name="__hash__" value="ee640c010f391e512ea705ab2eeae4bf_22691f10ab60e44a2c1bb5cd272e2bcf" /></form>
</fieldset>
    </section>
</div>
<div class="span3">
    <div class="tabs">
    <div class="tabs-tit">
        <h3>最新文章</h3>
    </div>
    <div class="tabs-box">
        <ul>
            <li>
                    <a href="/Article/read/aid/50" title="222222222"><small>07/23</small>222222222</a>
                </li><li>
                    <a href="/Article/read/aid/48" title="12312312"><small>05/24</small>12312312</a>
                </li><li>
                    <a href="/Article/read/aid/46" title="JSONP跨域实例"><small>05/16</small>JSONP跨域实例</a>
                </li><li>
                    <a href="/Article/read/aid/45" title="jQuery 点击空白地方便的点击展开/关闭效果非常方便的点击展开/关闭效果"><small>05/16</small>jQuery 点击空白地方便的点击展...</a>
                </li><li>
                    <a href="/Article/read/aid/44" title="专业的身份证验证，不用正则验证身份证"><small>04/29</small>专业的身份证验证，不用正则验证...</a>
                </li><li>
                    <a href="/Article/read/aid/43" title="用php实现Google /Baidu Ping服务快速收录"><small>04/13</small>用php实现Google /Baidu Ping服...</a>
                </li><li>
                    <a href="/Article/read/aid/42" title="计算两个日期相差 年 月 日"><small>04/13</small>计算两个日期相差 年 月 日</a>
                </li><li>
                    <a href="/Article/read/aid/41" title="PHP字符串截取，支持gb2312和UTF-8编码。"><small>04/13</small>PHP字符串截取，支持gb2312和UT...</a>
                </li>        </ul>
    </div>
</div>
<div class="tabs">
    <div class="tabs-tit">
        <h3>热门文章</h3>
    </div>
    <div class="tabs-box">
        <ul>
            <li>
                    <a href="/Article/read/aid/20" title="clearfix清除浮动闭合容器之:after与:before"><small>3089</small>clearfix清除浮动闭合容器之:af...</a>
                </li><li>
                    <a href="/Article/read/aid/1" title="iframe自动适应高度1"><small>213</small>iframe自动适应高度1</a>
                </li><li>
                    <a href="/Article/read/aid/2" title="图片水平垂直居中jquery-center-image"><small>147</small>图片水平垂直居中jquery-center...</a>
                </li><li>
                    <a href="/Article/read/aid/5" title="jQuery返回顶部代码"><small>125</small>jQuery返回顶部代码</a>
                </li><li>
                    <a href="/Article/read/aid/17" title="jQuery 图片水平垂直居中 另一方法"><small>115</small>jQuery 图片水平垂直居中 另一方法</a>
                </li><li>
                    <a href="/Article/read/aid/18" title="jQuery常用技巧"><small>115</small>jQuery常用技巧</a>
                </li><li>
                    <a href="/Article/read/aid/22" title="弹出窗口插件colorbox "><small>115</small>弹出窗口插件colorbox </a>
                </li><li>
                    <a href="/Article/read/aid/46" title="JSONP跨域实例"><small>115</small>JSONP跨域实例</a>
                </li>        </ul>
    </div>
</div>
<div class="tabs">
    <div class="tabs-tit">
        <h3>文章分类</h3>
    </div>
    <div class="tabs-box">
        <ul>
            <li >
                    <a href="/Article/index/date/2013-07" title="2013-07"><small>1</small>2013-07</a>
                </li><li >
                    <a href="/Article/index/date/2013-05" title="2013-05"><small>3</small>2013-05</a>
                </li><li >
                    <a href="/Article/index/date/2013-04" title="2013-04"><small>5</small>2013-04</a>
                </li><li >
                    <a href="/Article/index/date/2012-11" title="2012-11"><small>4</small>2012-11</a>
                </li><li >
                    <a href="/Article/index/date/2012-10" title="2012-10"><small>4</small>2012-10</a>
                </li><li >
                    <a href="/Article/index/date/2012-09" title="2012-09"><small>6</small>2012-09</a>
                </li><li >
                    <a href="/Article/index/date/2012-08" title="2012-08"><small>6</small>2012-08</a>
                </li><li >
                    <a href="/Article/index/date/2012-07" title="2012-07"><small>14</small>2012-07</a>
                </li><li >
                    <a href="/Article/index/date/2012-06" title="2012-06"><small>5</small>2012-06</a>
                </li>        </ul>
    </div>
</div>
</div>
        </div>
        <div class="footer">
            <footer class="clearfix">
                
<div class="user-login">
    <a href="/Login/qq_login"><img src="/Honoer/Tpl/Home/Default/Public/Images/qq_login.png"></a>	
</div>
<div class="copyright">
        ®copyright ©2012 All Rights Reserved.&nbsp;&nbsp;友情链接请E-mail：bily@honoer.com</div>

            </footer>
        </div>
        <script type='text/javascript' src="/Public/Plugins/jQuery/Validform_v5.3.2_min.js"></script>
        <script type="text/javascript" src="/Public/Plugins/jQuery/jquery.lazyload.min.js"></script>
        <script type="text/javascript" src="/Public/Plugins/syntaxhighlighter/scripts/brush.js"></script>
        <script type="text/javascript" src="/Honoer/Tpl/Home/Default/Public/Js/function.js"></script>
            </body>
</html>