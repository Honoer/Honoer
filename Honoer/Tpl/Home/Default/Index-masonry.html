<style>
    .waterfall {width: 90%;}
    .waterfall .item-box{
        border: 1px solid #D4D4D4;
        border-radius: 5px 5px 5px 5px;
        margin: 0 10px 10px 0;
        padding: 10px;
        position: relative;
        width: 29.5%;
    }

</style>
<script type="text/javascript" src="__PUBLIC__/Plugins/jQuery/jquery.masonry_2.1.min.js"></script>
<div id="waterfall" class="waterfall link">
    <volist name="data" id="vo">
        <div class="item-box">
            <ul>
                <li>{$key}</li>
                <li>{$vo.title}</li>
                <li>{$vo.name}</li>
            </ul>
        </div>
    </volist>
</div>


<!--加载中-->
<div id="loading" class="loading-wrap">
    <span class="loading">加载中，请稍后...</span>
</div>
<div class="clearfix"></div>
<!--加载中-->
<script type="text/javascript">
    $(function(){
        var $container = $('#waterfall');
        $container.masonry({ itemSelector : '.item-box', isAnimated: true });
        var loading = $("#loading").data("on", false);
        var page=1;
        $(window).scroll(function(){
            if(loading.data("on")) return ;
            //-$('.footer').height()
            if($(document).scrollTop() > $(document).height()-$(window).height()-70){
                loading.data("on", true).fadeIn();
                page++;
                var url = "http://www.17php.org/index.php/Index/ajaxArticle";
                url = "{:U('Article/send')}";
                getArticle(url,page);
            }
        });
        
        
        
        var getArticle = function(url,p){
            $.ajax({
                url:url,
                data:{p:p},
                dataType:'json',
                error:function(e){
                    console.log(e);
                },
                success:function(obj){
                    var data = obj.data.data;
                    var html = "";
                    if(!$.isEmptyObject(data)){
                        $.each(data,function(){
                            html +='<div class="item-box"><ul>';
                            html +='<li>'+this.article_id+'</li>';
                            if(this.article_picpath)
                                html +='<li><img width="250" height="250" src="'+this.article_picpath+'" class="img-polaroid" /></li>';
                            html +='<li><a href="/article-'+this.article_title+'.html" title="'+this.article_title+'">'+this.article_title+'</a></li>';
                            html +='<li>'+this.article_intro+'</li>';
                            html +='<li><i class="icon-user"></i> 作者：<a target="_blank" href="/user-'+this.user_nickname+'.html">'+this.user_nickname+'</a></li>';
                            html +='<li><i class="icon-folder-open"></i> 分类：<a target="_blank" href="'+this.class_name+'">'+this.class_name+'</a></li>';
                            html +='<li><i class="icon-eye-open"></i> 被围观'+this.article_view+'次  <a href="/article-'+this.article_id+'.html" class="fr"><i class="icon-random"></i> 去围观</a></li>';
                            html +='</ul></div>';
                        })
                        var $newElems = $(html).css({ opacity: 0 }).appendTo($container);
                        $newElems.imagesLoaded(function(){
                            $newElems.animate({ opacity: 1 });
                            $container.masonry( 'appended', $newElems, true );
                        });
                        loading.data("on", false).fadeOut();
                    }else{
                        loading.find("span").html("已经加载完了所有的记录");
                        setTimeout(function(){
                            loading.fadeOut();
                        },2000);
                    }
                }
            });
        }
    });
    
    
    
    
    
</script>